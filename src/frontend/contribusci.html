<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlanetSaver - Contribuisci</title>
    <link rel="stylesheet" href="stile.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>PlanetSaver - Contribuisci</h1>
            <div class="navbar-container">
                <nav>
                    <ul>
                        <li><a href="./index.html" class="current">Home</a></li>
                        <li><a href="#">Buy Trees</a></li>
                        <li><a href="#">Projects</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </nav>
                <button id="auth-button" class="login-button" onclick="handleAuthClick()">LOGIN</button>
                <span id="login-message" class="message">You are not logged in</span>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <h2>Acquista Alberi</h2>
            <form id="purchase-form">
                <label id="wallet">Wallet: FDNKDFGKNFDGANL</label>
                <p></p>
                <label for="quantity">Quantità:</label>
                <select id="quantity" name="quantity">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                </select>
            
                
                <label for="cause">Causa:</label>
                <select id="cause" name="cause">
                    <option value="Fighting Illegal Deforestation">Fighting Illegal Deforestation</option>
                    <option value="Restore olive groves affected by Xylella">Restore olive groves affected by Xylella</option>
                    <option value="Restoring CO2">Restoring CO2</option>
                </select>
                
                <div class="preview">
                    <p>Prezzo d'acquisto: <span id="price-preview">€0</span></p>
                    <p>CO2 equivalente: <span id="co2-preview">0 kg</span></p>
                    <p>Tempo necessario per piantare: <span id="time-preview">0 ore</span></p>
                </div>
                
                <button type="submit">Acquista</button>
            </form>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 PlanetSaver. All rights reserved.</p>
        </div>
    </footer>

    <script>
        document.getElementById('purchase-form').addEventListener('change', updatePreviews);

        function updatePreviews() {
            const quantity = document.getElementById('quantity').value;
            const price = quantity * 10; // Prezzo esempio: 10 euro per albero
            const co2 = quantity * 20; // CO2 esempio: 20 kg per albero
            const time = quantity * 1; // Tempo esempio: 1 ora per albero

            document.getElementById('price-preview').textContent = `€${price}`;
            document.getElementById('co2-preview').textContent = `${co2} kg`;
            document.getElementById('time-preview').textContent = `${time} ore`;
        }
    </script> <script>
        // Funzione per controllare lo stato di autenticazione dal server
        async function checkAuthStatus() {
            try {
                const response = await fetch('/auth-status');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                return data.authenticated;
            } catch (error) {
                console.error('Errore nel controllare lo stato di autenticazione:', error);
                return false;
            }
        }

        // Mostra o nasconde il messaggio basato sullo stato di login
        async function showLoginMessage() {
            const messageElement = document.getElementById('login-message');
            const authButton = document.getElementById('auth-button');
            const isLoggedIn = await checkAuthStatus();
            
            if (isLoggedIn) {
                messageElement.textContent = 'Login effettuato con successo';
                messageElement.className = 'message success';
                messageElement.style.display = 'inline';
                authButton.textContent = 'LOGOUT';
                authButton.onclick = () => location.href = '/logout';
            } else {
                messageElement.textContent = 'Non sei loggato';
                messageElement.className = 'message error';
                messageElement.style.display = 'inline';
                authButton.textContent = 'LOGIN';
                authButton.onclick = () => location.href = '/login';
            }
        }

        // Chiama la funzione quando la pagina è caricata
        window.onload = showLoginMessage;
    </script>

</body>
</html>

